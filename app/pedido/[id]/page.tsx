"use client";  import { useState, useEffect } from "react"; import { useRouter } from "next/navigation"; import Link from "next/link";  const API_URL = process.env.NEXT_PUBLIC_API_URL || "https://pronto-backend-j48e.onrender.com";  interface OrderTracking {   id: string;   orderNumber: number;   status: string;   paymentStatus: string;   paymentMethod: string;   subtotalCents: number;   discountCents: number;   totalCents: number;   deliveryFeeCents: number;   notes: string | null;   prepStartedAt: string | null;   readyAt: string | null;   createdAt: string;   updatedAt: string;   restaurant: {     name: string;     phone: string;     logoUrl: string | null;     address: string | null;     slug: string;   };   customer: {     name: string;     phone: string;   };   address: any;   items: Array<{     quantity: number;     priceCents: number;     productName: string;     productImage: string | null;     observations: string | null;   }>; }  export default function TrackingPage({ params }: { params: { id: string } }) {   const { id } = params;   const router = useRouter();   const [order, setOrder] = useState<OrderTracking | null>(null);   const [loading, setLoading] = useState(true);   const [error, setError] = useState(false);    const loadOrder = async () => {     try {       const response = await fetch(`${API_URL}/api/tracking/${id}`);       if (response.ok) {         const data = await response.json();         setOrder(data);         setError(false);       } else {         setError(true);       }     } catch (err) {       console.error("Erro ao carregar pedido:", err);       setError(true);     } finally {       setLoading(false);     }   };    useEffect(() => {     loadOrder();      // Polling: atualizar a cada 10 segundos     const interval = setInterval(loadOrder, 10000);     return () => clearInterval(interval);   }, [id]);    if (loading) {     return (       <div className="min-h-screen bg-gradient-to-br from-emerald-50 to-teal-50 flex items-center justify-center">         <div className="text-center">           <div className="w-16 h-16 border-4 border-emerald-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>           <p className="text-lg text-gray-600">Carregando pedido...</p>         </div>       </div>     );   }    if (error || !order) {     return (       <div className="min-h-screen bg-gradient-to-br from-red-50 to-pink-50 flex items-center justify-center p-4">         <div className="bg-white rounded-2xl shadow-xl p-8 max-w-md text-center">           <div className="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">             <svg className="w-8 h-8 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">               <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />             </svg>           </div>           <h1 className="text-2xl font-bold text-gray-900 mb-2">Pedido n├úo encontrado</h1>           <p className="text-gray-600 mb-6">Verifique o link e tente novamente</p>           <Link href="/" className="inline-block px-6 py-3 bg-emerald-600 text-white font-bold rounded-xl hover:bg-emerald-700">             Voltar para in├¡cio           </Link>         </div>       </div>     );   }    const statusSteps = [     { key: "pending", label: "Recebido", icon: "Ô£ô" },     { key: "confirmed", label: "Confirmado", icon: "­ƒæ¿ÔÇì­ƒì│" },     { key: "preparing", label: "Preparando", icon: "­ƒöÑ" },     { key: "ready", label: "Pronto", icon: "Ô£à" },     { key: "delivered", label: "Finalizado", icon: "­ƒÄë" },   ];    const currentStepIndex = statusSteps.findIndex(s => s.key === order.status);   const isCancelled = order.status === "cancelled";    const formatCurrency = (cents: number) => {     return new Intl.NumberFormat("pt-BR", {       style: "currency",       currency: "BRL",     }).format(cents / 100);   };    const formatDate = (dateString: string) => {     return new Date(dateString).toLocaleString("pt-BR", {       day: "2-digit",       month: "2-digit",       year: "numeric",       hour: "2-digit",       minute: "2-digit",     });   };    const getPaymentMethodLabel = (method: string | null) => {     const methods: Record<string, string> = {       pix: "PIX",       credit_card: "Cart├úo de Cr├®dito",       cash: "Dinheiro",       credit_card_delivery: "Cr├®dito na entrega",       debit_delivery: "D├®bito na entrega",       meal_voucher: "Vale refei├º├úo",       food_voucher: "Vale alimenta├º├úo",     };     return methods[method || ""] || method || "N├úo informado";   };    const getPaymentStatusLabel = (status: string) => {     const statuses: Record<string, { label: string; color: string }> = {       pending: { label: "Aguardando pagamento", color: "text-yellow-600 bg-yellow-100" },       paid: { label: "Pago", color: "text-green-600 bg-green-100" },       failed: { label: "Falhou", color: "text-red-600 bg-red-100" },       approved: { label: "Aprovado", color: "text-green-600 bg-green-100" },       rejected: { label: "Rejeitado", color: "text-red-600 bg-red-100" },     };     return statuses[status] || { label: status, color: "text-gray-600 bg-gray-100" };   };    const handleWhatsApp = () => {     const phone = order.restaurant.phone.replace(/\D/g, "");     const message = `Ol├í! Tenho uma d├║vida sobre o pedido #${order.orderNumber}`;     window.open(`https://wa.me/${phone}?text=${encodeURIComponent(message)}`, "_blank");   };    const paymentStatusInfo = getPaymentStatusLabel(order.paymentStatus);    return (     <div className="min-h-screen bg-gradient-to-br from-emerald-50 via-teal-50 to-cyan-50">       {/* Header */}       <header className="bg-white border-b border-gray-200 sticky top-0 z-40 shadow-sm">         <div className="max-w-full sm:max-w-4xl mx-auto px-4 py-4 flex items-center justify-between">           <Link href={`/r/${order.restaurant.slug}`} className="flex items-center gap-2 text-gray-700 hover:text-gray-900">             <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">               <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 19l-7-7m0 0l7-7m-7 7h18" />             </svg>             Voltar ao card├ípio           </Link>           {order.restaurant.logoUrl && (             <img src={order.restaurant.logoUrl} alt={order.restaurant.name} className="h-8 object-contain" />           )}         </div>       </header>        <div className="max-w-full sm:max-w-4xl mx-auto px-4 py-8">         {/* Status Card */}         <div className="bg-white rounded-3xl shadow-2xl p-4 sm:p-6 md:p-8 mb-6">           {/* Header com n├║mero do pedido */}           <div className="text-center mb-8">             <div className="inline-block px-6 py-2 bg-gradient-to-r from-emerald-600 to-teal-600 rounded-full mb-4">               <span className="text-white font-bold text-lg">Pedido #{order.orderNumber}</span>             </div>             <h1 className="text-2xl md:text-3xl font-bold text-gray-900 mb-2">{order.restaurant.name}</h1>             <p className="text-gray-600">Pedido realizado em {formatDate(order.createdAt)}</p>           </div>            {/* Status Progress */}           {!isCancelled ? (             <div className="mb-8">               <div className="flex items-center justify-between relative">                 {/* Linha de progresso */}                 <div className="absolute top-5 left-0 right-0 h-1 bg-gray-200">                   <div                     className="h-full bg-gradient-to-r from-emerald-600 to-teal-600 transition-all duration-500"                     style={{ width: `${(currentStepIndex / (statusSteps.length - 1)) * 100}%` }}                   />                 </div>                  {/* Steps */}                 {statusSteps.map((step, index) => {                   const isCompleted = index <= currentStepIndex;                   const isCurrent = index === currentStepIndex;                    return (                     <div key={step.key} className="flex flex-col items-center relative z-10" style={{ flex: 1 }}>                       <div                         className={`w-10 h-10 md:w-12 md:h-12 rounded-full flex items-center justify-center text-lg sm:text-xl md:text-2xl transition-all duration-300 ${                           isCompleted                             ? "bg-gradient-to-br from-emerald-600 to-teal-600 text-white shadow-lg"                             : "bg-gray-200 text-gray-400"                         } ${isCurrent ? "scale-110 ring-4 ring-emerald-200" : ""}`}                       >                         {step.icon}                       </div>                       <span                         className={`mt-2 text-xs md:text-sm font-bold text-center ${                           isCompleted ? "text-emerald-600" : "text-gray-400"                         }`}                       >                         {step.label}                       </span>                     </div>                   );                 })}               </div>             </div>           ) : (             <div className="mb-8 bg-red-50 border-2 border-red-200 rounded-2xl p-4 sm:p-6 text-center">               <div className="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">                 <svg className="w-8 h-8 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">                   <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />                 </svg>               </div>               <h2 className="text-2xl font-bold text-red-600 mb-2">Pedido Cancelado</h2>               <p className="text-gray-600">Este pedido foi cancelado</p>             </div>           )}            {/* Payment Status */}           <div className="mb-6">             <div className={`inline-flex items-center gap-2 px-4 py-2 rounded-full font-bold ${paymentStatusInfo.color}`}>               <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">                 <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z" />               </svg>               {paymentStatusInfo.label} ÔÇó {getPaymentMethodLabel(order.paymentMethod)}             </div>           </div>            {/* Bot├úo WhatsApp */}           <button             onClick={handleWhatsApp}             className="w-full py-4 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-bold rounded-xl shadow-lg flex items-center justify-center gap-3 transition-all"           >             <svg className="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">               <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/>             </svg>             Falar com o restaurante           </button>         </div>          {/* Itens do pedido */}         <div className="bg-white rounded-3xl shadow-xl p-4 sm:p-6 md:p-8 mb-6">           <h2 className="text-lg sm:text-xl font-bold text-gray-900 mb-4 flex items-center gap-2">             <svg className="w-6 h-6 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">               <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" />             </svg>             Itens do pedido           </h2>            <div className="space-y-4">             {order.items.map((item, index) => (               <div key={index} className="flex items-start gap-4 pb-4 border-b border-gray-100 last:border-0">                 {item.productImage && (                   <img                     src={item.productImage}                     alt={item.productName}                     className="w-16 h-16 object-cover rounded-lg"                   />                 )}                 <div className="flex-1">                   <div className="flex items-start justify-between">                     <div>                       <p className="font-bold text-gray-900">                         {item.quantity}x {item.productName}                       </p>                       {item.observations && (                         <p className="text-sm text-gray-600 mt-1">Obs: {item.observations}</p>                       )}                     </div>                     <p className="font-bold text-emerald-600">{formatCurrency(item.priceCents * item.quantity)}</p>                   </div>                 </div>               </div>             ))}           </div>            {/* Totais */}           <div className="mt-6 pt-6 border-t-2 border-gray-200 space-y-2">             <div className="flex justify-between text-gray-600">               <span>Subtotal</span>               <span>{formatCurrency(order.subtotalCents)}</span>             </div>             {order.discountCents > 0 && (               <div className="flex justify-between text-green-600">                 <span>Desconto</span>                 <span>-{formatCurrency(order.discountCents)}</span>               </div>             )}             {order.deliveryFeeCents > 0 && (               <div className="flex justify-between text-gray-600">                 <span>Taxa de entrega</span>                 <span>{formatCurrency(order.deliveryFeeCents)}</span>               </div>             )}             <div className="flex justify-between text-lg sm:text-xl font-bold text-gray-900 pt-2">               <span>Total</span>               <span className="text-emerald-600">{formatCurrency(order.totalCents)}</span>             </div>           </div>         </div>          {/* Endere├ºo de entrega */}         {order.address && (           <div className="bg-white rounded-3xl shadow-xl p-4 sm:p-6 md:p-8 mb-6">             <h2 className="text-lg sm:text-xl font-bold text-gray-900 mb-4 flex items-center gap-2">               <svg className="w-6 h-6 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">                 <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />                 <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />               </svg>               Endere├ºo de entrega             </h2>             <p className="text-gray-700">               {order.address.street}, {order.address.number}               {order.address.complement && ` - ${order.address.complement}`}             </p>             <p className="text-gray-600 text-sm mt-1">               {order.address.district} - {order.address.city}, {order.address.state}             </p>             {order.address.reference && (               <p className="text-gray-600 text-sm mt-1">Refer├¬ncia: {order.address.reference}</p>             )}           </div>         )}          {/* Observa├º├Áes */}         {order.notes && (           <div className="bg-white rounded-3xl shadow-xl p-4 sm:p-6 md:p-8">             <h2 className="text-lg sm:text-xl font-bold text-gray-900 mb-4 flex items-center gap-2">               <svg className="w-6 h-6 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">                 <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z" />               </svg>               Observa├º├Áes             </h2>             <p className="text-gray-700">{order.notes}</p>           </div>         )}       </div>     </div>   ); }